/*	
 *	jQuery Touch Optimized Sliders "R"Us 1.4.0
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	tosrus.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */
!function(e){function t(e,t,n,s,a){a.slides.collect?i(e,t,n,s,a):o(e,t,n,s,a);var r=s.children();a.slides.css&&r.css(a.slides.css);var d=a.slides.width;return a.slidesWidthPercentage&&(d+="%"),r.css("width",d),r}function i(t,i,o,n,s){w(i,s).addClass(O("zoom")),i.css(s.anchors.css).each(function(t){var i=e(this),a=e('<div class="'+O("slide")+" "+O("loading")+'" />').data(R("anchor"),i).data(R("content"),i.attr("href")).appendTo(n);if(i.data(R("slide"),a).bind(U(s.anchors.event),function(e){e.preventDefault(),o.trigger(U("open"),[t])}),s.caption){a.data(R("caption"),"");for(var r=0,d=s.caption.length;d>r;r++){var c=i.attr(s.caption[r]);if(c&&c.length){a.data(R("caption"),c);break}}}})}function o(t,i,o,s,a){t.children().each(function(){var t=e(this);e('<div class="'+O("slide")+'" />').append(t).appendTo(s),t=t.parent(),t.data(R("caption"),"");var i=t.children(),o="html",r="youtube";if(i.is("img"))o="image";else if(i.is("iframe")&&i.attr("src")){var d=i.attr("src").toLowerCase();d.indexOf("youtube.com/embed/")>-1?o="video":d.indexOf("vimeo.com/video/")>-1&&(o="video",r="vimeo")}switch(t.data(R("contenttype"),o),o){case"image":a.touch.zoom&&e.fn.TosRUs.pinchZoom(i);break;case"html":i.wrap('<div class="'+O("content")+'" />');break;case"video":t.data(R("videotype"),r),n(t,a.video.ratio,a.video.maxWidth,a.video.maxHeight)}})}function n(e,t,i,o){var n=e.children();e.addClass(O("video")).bind(U("resizeVideo"),function(){n.removeAttr("style");var s=e.width(),a=e.height();i&&s>i&&(s=i),o&&a>o&&(a=o),t>s/a?a=s/t:s=a*t,n.width(s),n.height(a)}),j.bind(U("resize"),function(){e.trigger(U("resizeVideo"))})}function s(t,i){e.each(i,function(e,i){i&&i.bind(U("click"),function(i){i.stopPropagation(),i.preventDefault(),t.trigger(U(e))})})}function a(t,i){(i.prev.key||i.next.key||i.close.key)&&e(document).bind(U("keyup"),function(e){var o=e.keyCode;(27==o||37==o||39==o)&&t.data(R("opened"))&&(27==o&&i.close.key?(e.preventDefault(),t.trigger(U("close"))):(37==o&&i.prev.key||39==o&&i.next.key)&&(e.preventDefault(),t.trigger(U(37==o?"prev":"next"))))})}function r(t,i,o,n,s){var a=L;e.isNumeric(o)&&(a=o,o=!1),o?t.css(i):setTimeout(function(){t.animate(i,{duration:a,complete:n,easing:s,queue:!1})},1)}function d(t,i,o){return e("<div />").css("width",i).animate({width:o},{duration:L/2,step:function(e){t.css({transform:"scale("+e+")"})}}),o}function c(e,t,i){return"number"==typeof t&&t>e&&(e=t),"number"==typeof i&&e>i&&(e=i),e}function l(e,t){return t.data(R("index"),e),e}function p(e,t){return t.data(R("opened"),e),e}function u(e,t,i,o,n){e&&e[(1>i?"add":"remove")+"Class"](O("disabled")),t&&t[(i>=o-n.slides.visible?"add":"remove")+"Class"](O("disabled"))}function f(t,i,o){if(M){var n=M.getScale();if("undefined"!=typeof n){n=1/n;for(var s=e(),a=0,r=t.length;r>a;a++)t[a]&&(s=s.add(t[a]));setTimeout(function(){i&&i.css({"text-size-adjust":Math.ceil(100*c(n,1,3))+"%"}),s.css({transform:"scale("+c(n,1,2)+")"})},o||1)}}}function h(e,t,i){g(e,t,t+i.slides.visible,i),setTimeout(function(){g(e,t-i.slides.visible,t,i),g(e,t+i.slides.visible,t+2*i.slides.visible,i)},500)}function g(t,i,o,s){t.children().slice(i,o).each(function(){var i=e(this);if(0==i.children().length){var o=i.data(R("content")),a=o,r=!1,d="youtube";switch(e.inArray(o.toLowerCase().split(".").pop().split("?")[0],["jpg","jpe","jpeg","gif","png"])>-1?r="image":0==o.indexOf("#")?(o=e(o),r="html"):o.toLowerCase().indexOf("youtube.com/watch")>-1?(o=o.split("?v=")[1].split("&")[0],s.video.imageLink?(o="http://img.youtube.com/vi/"+o+"/0.jpg",r="videolink"):(o="http://www.youtube.com/embed/"+o,r="video")):o.toLowerCase().indexOf("vimeo.com/")>-1&&(o="http://player.vimeo.com/video/"+o.split("vimeo.com/")[1].split("?")[0]+"?api=1",r="video",d="vimeo"),i.data(R("contenttype"),r),r){case"image":case"videolink":e('<img border="0" />').bind(U("load"),function(t){t.stopPropagation(),i.removeClass(O("loading")),"videolink"==r?e('<a href="'+a+'" class="'+O("play")+'" />').appendTo(i):s.touch.zoom&&e.fn.TosRUs.pinchZoom(e(this))}).appendTo(i).attr("src",o);break;case"html":i.removeClass(O("loading")),e('<div class="'+O("content")+'" />').append(o).appendTo(i);break;case"video":i.data(R("videotype"),d);var c=i.data(R("anchor"));e('<iframe src="'+o+'" frameborder="0" allowfullscreen />').appendTo(i),n(i,c.data(R("ratio"))||s.video.ratio,c.data(R("maxWidth"))||s.video.maxWidth,c.data(R("maxHeight"))||s.video.maxHeight),setTimeout(function(){i.removeClass(O("loading"))},2500)}t.parent().trigger("loading",[i.data(R("anchor")),i])}"video"==i.data(R("contenttype"))&&i.trigger(U("resizeVideo"))})}function v(t,i){t.each(function(){var t=e(this),o=t.find("iframe")[0];switch(t.data(R("videotype"))){case"youtube":o.contentWindow.postMessage('{ "event": "command", "func": "'+i+'Video" }',"*");break;case"vimeo":"stop"==i&&(i="unload"),o.contentWindow.postMessage('{ "method": "'+i+'" }',"*")}})}function m(t,i){var o=e();return i.slides.collect&&(o=o.add(t.filter('a[href*=".gif"]')),o=o.add(t.filter('a[href*=".png"]')),o=o.add(t.filter('a[href*=".jpg"]')),o=o.add(t.filter('a[href*=".jpe"]')),o=o.add(t.filter('a[href*=".jpeg"]')),o=o.add(t.filter('a[href^="#"][href!="#"]')),o=o.add(t.filter('a[href*="youtube.com/watch?v="]')),o=o.add(t.filter('a[href*="vimeo.com/"]'))),o}function w(t,i){var o=e();return i.anchors.zoomIcon&&t.each(function(){var t=e(this),i=t.children();1==i.length&&i.is("img")&&i.width()>99&&i.height()>99&&(o=o.add(t))}),o}function b(t,i,o){if(e.isFunction(t.wrapper)?t.wrapper={target:t.wrapper.call(o)}:"string"==typeof t.wrapper&&(t.wrapper={target:e(t.wrapper)}),t.wrapper=x(t.wrapper,{}),"boolean"==typeof t.touch&&(t.touch={drag:t.touch,zoom:t.touch}),t.touch=x(t.touch,{}),e.isNumeric(t.slides)?t.slides={visible:t.slides}:"string"==typeof t.slides&&(t.slides={scale:t.slides}),t.slides=x(t.slides,{}),"boolean"==typeof t.anchors?t.anchors={zoomIcon:t.anchors}:"string"==typeof t.anchors&&(t.anchors={event:t.anchors}),t.anchors=x(t.anchors,{}),e.isNumeric(t.video)&&(t.video={ratio:t.video}),t.video=x(t.video,{}),t.wrapper.css=x(t.wrapper.css,{}),e.isFunction(t.wrapper.target)&&(t.wrapper.target=t.wrapper.target.call(o)),"string"==typeof t.wrapper.target&&(t.wrapper.target=e(t.wrapper.target)),t.wrapper.target instanceof e&&0!=t.wrapper.target.length||(t.wrapper.target=t.slides.collect===!1?i:"window"),t.show=T(t.show,!("window"==t.wrapper.target)),t.touch=e.fn.hammer?{drag:T(t.touch.drag,N),zoom:T(t.touch.zoom,N&&"window"==t.wrapper.target)}:{drag:!1,zoom:!1},t.buttons=T(t.buttons,!t.touch.drag),t.keys=T(t.keys,!t.touch.drag&&!t.buttons),"string"==typeof t.caption&&(t.caption=[t.caption]),t.caption===!1||e.isArray(t.caption)||(t.caption="window"==t.wrapper.target||t.caption===!0?["rel","title"]:!1),e.isNumeric(t.slides.width))t.slidesWidthPercentage=!1,t.slides.visible=k(t.slides.visible,1);else{var n=P(t.slides.width)?z(t.slides.width):!1;t.slidesWidthPercentage=!0,t.slides.visible=k(t.slides.visible,n?Math.floor(100/n):1),t.slides.width=n?n:Math.ceil(1e4/t.slides.visible)/100}return t.slides.offset=P(t.slides.offset)?z(t.slides.offset):k(t.slides.offset,0),t.slides.collect=T(t.slides.collect,"window"==t.wrapper.target),t.slides.scale=C(t.slides.scale,"fit"),t.slides.css=x(t.slides.css,{}),t.anchors.zoomIcon=T(t.anchors.zoomIcon,!N&&"window"==t.wrapper.target),t.anchors.event=C(t.anchors.event,"click"),t.anchors.css=x(t.anchors.css,{}),t=y("prev",t),t=y("next",t),t=y("close",t),t.video.ratio=k(t.video.ratio,16/9),t.video.maxWidth=k(t.video.maxWidth,!1),t.video.maxHeight=k(t.video.maxHeight,!1),t.video.imageLink=T(t.video.imageLink,N),t}function y(t,i){var o="close"!=t;switch(o&&e.isNumeric(i[t])&&(i[t]={slides:i[t]}),typeof i[t]){case"boolean":case"string":i[t]={button:i[t]}}if(e.isPlainObject(i[t])||(i[t]={}),o&&(!e.isNumeric(i[t].slides)||i[t].slides<1)&&(i[t].slides=i.slides.visible),"string"==typeof i[t].button&&(i[t].button=e(i[t].button)),!(i[t].button instanceof e)){var n=o?i.buttons:"window"==i.wrapper.target;i[t].button=T(i[t].button,n)}var s=o?i.keys:"window"==i.wrapper.target&&(i.keys||!i[t].button);return i[t].key=T(i[t].key,s),i}function x(t,i){return e.isPlainObject(t)||(t=i),t}function T(e,t){return"boolean"!=typeof e&&(e=t),e}function k(t,i){return e.isNumeric(t)||(t=i),t}function C(e,t){return"string"!=typeof e&&(e=t),e}function P(e){return"string"==typeof e&&"%"==e.slice(-1)}function z(e){return parseInt(e.slice(0,-1))}if(!e.fn.TosRUs){var j,D,W,M=!1,N="ontouchstart"in window,L=400;e.fn.TosRUs=e.fn.tosrus=function(i,o,n){if(0==this.length)return this;var d=this,c=this[0];i=x(i,{}),i=N?e.extend(!0,{},i,n):e.extend(!0,{},i,o);var g=b(i,d,c),w="window"==g.wrapper.target,y=0,T=0,k=0;j=e(window),D=e("html"),W=e("body"),!M&&N&&"undefined"!=typeof FlameViewportScale&&(M=new FlameViewportScale);var C=e('<div class="'+O("wrapper")+'" />'),P=e('<div class="'+O("slider")+'" />').appendTo(C),z=null,I=null,V=null,H=null;C.css(g.wrapper.css).addClass(O(w?"fixed":"inline")).addClass(O(N?"touch":"desktop")).addClass(O(g.slides.scale)),g.caption&&(I=e('<div class="'+O("caption")+'" />').appendTo(C)),g.prev.button&&(V=g.prev.button instanceof e?g.prev.button:e('<a class="'+O("prev")+'" href="#" />').appendTo(C)),g.next.button&&(H=g.next.button instanceof e?g.next.button:e('<a class="'+O("next")+'" href="#" />').appendTo(C)),g.close.button&&(z=g.close.button instanceof e?g.close.button:e('<a class="'+O("close")+'" href="#" />').appendTo(C));var S=m(d,g),F=t(d,S,C,P,g);T=F.length,y=l(y,C),C.bind(U(""),function(e){e.stopPropagation()}).bind(U("open"),function(t,i,o){q||(w&&(k=j.scrollTop()),C.show().css("opacity",0).addClass(O("hover")),r(C,{opacity:1},o),f([V,H,z],I),C.trigger(U("opening"),[i,o])),h(P,y,g),o=o||!q,q=p(!0,C),e.isNumeric(i)&&C.trigger(U("slideTo"),[i,o])}).bind(U("close"),function(e,t){q&&(C.removeClass(O("hover")),v(C.find("."+O("video")),"stop"),"undefined"==typeof t&&(t=L/2),r(C,{opacity:0},t,function(){C.hide()}),C.trigger(U("closing"),[t])),q=p(!1,C)}).bind(U("prev")+" "+U("next"),function(t,i,o,n){e.isNumeric(i)||(i=g[t.type].slides),C.trigger(U("slideTo"),["prev"==t.type?y-i:y+i,o,n])}).bind(U("slideTo"),function(t,i,o,n){if(!q)return!1;if(!e.isNumeric(i))return!1;var s=!0;0>i?(i=0,0==y&&(s=!1)):i+g.slides.visible>T&&(i=T-g.slides.visible,y+g.slides.visible>=T&&(s=!1));var a=P.children().eq(y);if(y=l(i,C),h(P,y,g),u(V,H,y,T,g),s){var d=0-y*g.slides.width+g.slides.offset;if(g.slidesWidthPercentage&&(d+="%"),r(P,{left:d},o,null,n),g.caption){var c=P.children().eq(y).data(R("caption"));I.text(c)[c.length>0?"show":"hide"]()}v(a.filter("."+O("video")),"pause"),C.trigger(U("sliding"),[y,o])}}).bind(U("click"),function(){C.toggleClass(O("hover"))}),u(V,H,y,T,g),s(C,{prev:V,next:H,close:z}),j.bind(U("orientationchange"),function(){q&&f([V,H,z],I,250)}),a(C,g),g.touch.drag&&e.fn.TosRUs.dragSlide(C,g.slides.visible,T),w&&j.bind(U("scroll"),function(e){q&&(window.scrollTo(0,k),e.preventDefault(),e.stopImmediatePropagation())});var q=p(!0,C);return w?C.appendTo(W).trigger(U("close"),[!0]):(C.appendTo(g.wrapper.target),g.show?(q=p(!1,C),C.trigger(U("open"),[0,!0])):C.trigger(U("close"),[!0])),C},e.fn.TosRUs.isTouch=N,e.fn.TosRUs.dragSlide=function(e,t,i){var o=e.find("> ."+O("slider")),n=0,s=!1,a=!1;e.hammer().on(U("dragleft")+" "+U("dragright"),function(r){r.gesture.preventDefault(),r.stopPropagation(),n=r.gesture.deltaX,s=r.gesture.direction,a=!1,("left"==s&&e.data(R("index"))+t>=i||"right"==s&&0==e.data(R("index")))&&(n/=2.5),o.css("marginLeft",Math.round(n))}).on(U("swipeleft")+" "+U("swiperight"),function(e){e.gesture.preventDefault(),e.stopPropagation(),a=!0}).on(U("dragend"),function(i){i.gesture.preventDefault(),i.stopPropagation();var d=L/2;if("left"==s||"right"==s){var c=null;if(a){var l=t;c="swipeOutTos"}else var p=o.children().first().width(),l=Math.floor((Math.abs(n)+p/2)/p);l>0&&e.trigger(U("left"==s?"next":"prev"),[l,d,c])}r(o,{marginLeft:0},d,null,c),s=!1}).on(U("pinch"),function(e){e.gesture.preventDefault(),e.stopPropagation()})},e.fn.TosRUs.pinchZoom=function(e){var t=1,i=1,o=1,n=1;e.hammer().on(U("pinch"),function(s){s.gesture.preventDefault(),s.stopPropagation(),t=(s.gesture.scale-i)*o,i=s.gesture.scale,n=c(n+t,.5,4),e.css({transform:"scale( "+n+" )"})}).on(U("doubletap"),function(s){s.gesture.preventDefault(),s.stopPropagation(),t=0,i=1,n=o>1?1:3,o=d(e,o,n)}).on(U("release"),function(s){s.gesture.preventDefault(),s.stopPropagation(),t=0,i=1,o=n,1>o&&(n=1,o=d(e,o,n))})},jQuery.extend(jQuery.easing,{swipeOutTos:function(e,t,i,o,n){return o*Math.sin(t/n*(Math.PI/2))+i}});var O=function(e){return"tos-"+e},R=function(e){return"tos-"+e},U=function(e){return e+".tos"}}}(jQuery);